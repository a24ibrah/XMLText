<?xml version="1.0" encoding="ASCII"?>
<tosca:DocumentRoot xmlns:tosca="http://docs.oasis-open.org/tosca/ns/2011/12">
  <definitions id="MoodleDefinitions" name="Moodle Definitions" targetNamespace="http://www.example.com/tosca/ServiceTemplates/Moodle">
    <import importType="http://docs.oasis-open.org/tosca/ns/2011/12" location="TOSCA-v1.0-BaseTypes-Definitions.xml" namespace="http://docs.oasis-open.org/tosca/ns/2011/12/ToscaBaseTypes"/>
    <import importType="http://www.w3.org/2001/XMLSchema" location="../types/TOSCA-v1.0-BaseTypes.xsd" namespace="http://docs.oasis-open.org/tosca/ns/2011/12/ToscaBaseTypes"/>
    <import importType="http://docs.oasis-open.org/tosca/ns/2011/12" location="TOSCA-v1.0-SpecificTypes-Definitions.xml" namespace="http://docs.oasis-open.org/tosca/ns/2011/12/ToscaSpecificTypes"/>
    <import importType="http://www.w3.org/2001/XMLSchema" location="../types/TOSCA-v1.0-SpecificTypes.xsd" namespace="http://docs.oasis-open.org/tosca/ns/2011/12/ToscaSpecificTypes"/>
    <import importType="http://docs.oasis-open.org/tosca/ns/2011/12" location="MoodleTypes-Definitions.xml" namespace="http://www.example.com/tosca/Types/Moodle"/>
    <import importType="http://www.w3.org/2001/XMLSchema" location="../types/MoodleTypes.xsd" namespace="http://www.example.com/tosca/Types/Moodle"/>
    <serviceTemplate id="Moodle" name="Moodle Template">
      <topologyTemplate>
        <nodeTemplate id="VmApache" type="ns1.Server" name="VM for Apache">
          <properties>
            <map id="ServerProperties">
              <propertyKeyValuePair name="NumCpus" value="1"/>
              <propertyKeyValuePair name="Memory" value="1024"/>
            </map>
          </properties>
          <requirements>
            <requirement id="VmApache_networks" type="ns1.NetworkAttachmentRequirement" name="networks"/>
            <requirement id="VmApache_container" type="ns1.ServerContainerRequirement" name="container"/>
            <requirement id="VmApache_volumes" type="ns1.VolumeAttachmentRequirement" name="volumes"/>
          </requirements>
          <capabilities>
            <capability id="VmApache_os" type="ns1.OperatingSystemContainerCapability" name="os"/>
          </capabilities>
        </nodeTemplate>
        <nodeTemplate id="OsApache" type="ns1.OperatingSystem" name="OS for Apache">
          <requirements>
            <requirement id="OsApache_container" type="ns1.OperatingSystemContainerRequirement" name="container"/>
          </requirements>
          <capabilities>
            <capability id="OsApache_software" type="ns1.SoftwareContainerCapability" name="software"/>
          </capabilities>
        </nodeTemplate>
        <nodeTemplate id="ApacheWebServer" type="ns2.ApacheWebServer" name="Apache Web Server">
          <properties>
            <map id="ApacheWebServerProperties">
              <propertyKeyValuePair name="httpdport" value="80"/>
            </map>
          </properties>
          <requirements>
            <requirement id="ApacheWebServer_container" type="ns1.SoftwareContainerRequirement" name="container"/>
          </requirements>
          <capabilities>
            <capability id="ApacheWebServer_webapps" type="ns2.ApacheWebApplicationContainerCapability" name="webapps"/>
            <capability id="ApacheWebServer_modules" type="ns2.ApacheModuleContainerCapability" name="modules"/>
            <capability id="ApacheWebServer_clients" type="ns2.HTTPEndpointCapability" name="clients"/>
          </capabilities>
        </nodeTemplate>
        <nodeTemplate id="MoodleApp" type="ns3.MoodleApplication" name="Moodle App">
          <properties>
            <map id="MoodleApplicationProperties">
              <propertyKeyValuePair name="AdminUser" value="admin"/>
              <propertyKeyValuePair name="AdminPassword" value="moodle123"/>
              <propertyKeyValuePair name="SiteName" value="My Moodle"/>
              <propertyKeyValuePair name="SitePath" value="mymoodle"/>
            </map>
          </properties>
          <requirements>
            <requirement id="MoodleApp_phpRuntime" type="ns2.PHPRuntimeRequirement" name="phpRuntime"/>
            <requirement id="MoodleApp_database" type="ns3.MoodleDatabaseEndpointRequirement" name="database"/>
            <requirement id="MoodleApp_container" type="ns2.ApacheWebApplicationContainerRequirement" name="container"/>
          </requirements>
        </nodeTemplate>
        <nodeTemplate id="PhpModule" type="ns2.ApachePHPModule" name="PHP Module">
          <requirements>
            <requirement id="PhpModule_container" type="ns1.ApacheModuleContainerRequirement" name="container"/>
          </requirements>
          <capabilities>
            <capability id="PhpModule_phpApps" type="ns2.PHPRuntimeCapability" name="phpApps"/>
          </capabilities>
        </nodeTemplate>
        <nodeTemplate id="MySql" type="ns2.MySQL" name="MySQL">
          <properties>
            <map id="MySQLProperties">
              <propertyKeyValuePair name="RootPassword" value="password"/>
            </map>
          </properties>
          <requirements>
            <requirement id="MySql_container" type="ns1.SoftwareContainerRequirement" name="container"/>
          </requirements>
          <capabilities>
            <capability id="MySql_databases" type="ns2.MySQLDatabaseContainerCapability" name="databases"/>
          </capabilities>
        </nodeTemplate>
        <nodeTemplate id="MoodleDb" type="ns2.MoodleDatabase" name="Moodle DB">
          <properties>
            <map id="MoodleDatabaseProperties">
              <propertyKeyValuePair name="DBName" value="moodledb"/>
              <propertyKeyValuePair name="DBUser" value="mdladmin"/>
              <propertyKeyValuePair name="DBPassword" value="mdlamin"/>
              <propertyKeyValuePair name="DBPort" value="3306"/>
            </map>
          </properties>
          <requirements>
            <requirement id="MoodleDb_container" type="ns1.MySQLDatabaseContainerRequirement" name="container"/>
          </requirements>
          <capabilities>
            <capability id="MoodleDb_clients" type="ns2.MySQLDatabaseEndpointCapability" name="clients"/>
          </capabilities>
        </nodeTemplate>
        <relationshipTemplate id="OsApache_HostedOn_VmApache" type="ns1.HostedOn" name="hosted on">
          <sourceElement ref="OsApache_container"/>
          <targetElement ref="VmApache_os"/>
        </relationshipTemplate>
        <relationshipTemplate id="Apache_HostedOn_OsApache" type="ns1.HostedOn" name="hosted on">
          <sourceElement ref="ApacheWebServer_container"/>
          <targetElement ref="OsApache_software"/>
        </relationshipTemplate>
        <relationshipTemplate id="MoodleApp_HostedOn_Apache" type="ns1.HostedOn" name="hosted on">
          <sourceElement ref="MoodleApp_container"/>
          <targetElement ref="ApacheWebServer_webapps"/>
        </relationshipTemplate>
        <relationshipTemplate id="PhpModule_HostedOn_Apache" type="ns1.HostedOn" name="hosted on">
          <sourceElement ref="PhpModule_container"/>
          <targetElement ref="ApacheWebServer_modules"/>
        </relationshipTemplate>
        <relationshipTemplate id="MoodleApp_DependsOn_PhpModule" type="ns1.DependsOn" name="depends on">
          <sourceElement ref="MoodleApp_phpRuntime"/>
          <targetElement ref="PhpModule_phpApps"/>
        </relationshipTemplate>
        <relationshipTemplate id="MySqlHostedOnOsApache" type="ns1.HostedOn" name="hosted on">
          <sourceElement ref="MySql_container"/>
          <targetElement ref="OsApache_software"/>
        </relationshipTemplate>
        <relationshipTemplate id="MoodleDb_HostedOn_MySql" type="ns1.HostedOn" name="hosted on">
          <sourceElement ref="MoodleDb_container"/>
          <targetElement ref="MySql_databases"/>
        </relationshipTemplate>
        <relationshipTemplate id="MoodleApp_ConnectsTo_MoodleDb" type="ns1.MoodleDatabaseConnection" name="connects to">
          <sourceElement ref="MoodleApp_database"/>
          <targetElement ref="MoodleDb_clients"/>
        </relationshipTemplate>
      </topologyTemplate>
      <plans targetNamespace="http://www.example.com/tosca/ServiceTemplates/Moodle">
        <plan id="DeployMoodle" planLanguage="http://docs.oasis-open.org/wsbpel/2.0/process/executable" planType="http://docs.oasis-open.org/tosca/ns/2011/12/PlanTypes/BuildPlan">
          <inputParameters>
            <inputParameter name="region" required="yes" type="string"/>
            <inputParameter name="securityGroup" required="yes" type="string"/>
            <inputParameter name="keyPairName" required="yes" type="string"/>
            <inputParameter name="sshKey" required="yes" type="string-multiline"/>
            <inputParameter name="ami" required="yes" type="string"/>
            <inputParameter name="instanceType" required="yes" type="string"/>
            <inputParameter name="accessKey" required="yes" type="string-password"/>
            <inputParameter name="secretKey" required="yes" type="string-password"/>
            <inputParameter name="csarName" required="yes" type="string"/>
            <inputParameter name="containerApi" required="yes" type="string"/>
            <inputParameter name="callbackUrl" required="yes" type="callbackaddress"/>
            <inputParameter name="CorrelationID" required="yes" type="correlation"/>
          </inputParameters>
          <outputParameters>
            <outputParameter name="result" required="yes" type=""/>
            <outputParameter name="selfserviceApplicationUrl" required="yes" type=""/>
            <outputParameter name="webapp_createFolders_Result" required="yes" type=""/>
            <outputParameter name="webapp_fixRights_Result" required="yes" type=""/>
            <outputParameter name="webapp_ApacheWebServer_InstallDA_Result" required="yes" type=""/>
            <outputParameter name="webapp_ApacheWebServer_Install_Result" required="yes" type=""/>
            <outputParameter name="webapp_ApacheWebServer_Configure_Result" required="yes" type="string"/>
            <outputParameter name="webapp_ApacheWebServer_Start_Result" required="yes" type="string"/>
            <outputParameter name="webapp_PHPModule_InstallDA_Result" required="yes" type="string"/>
            <outputParameter name="webapp_ApacheModuleHostedOnApache_ConfAp_Result" required="yes" type="string"/>
            <outputParameter name="webapp_ApachePhpModule_Start_Result" required="yes" type="string"/>
            <outputParameter name="webapp_unpackMoodleZip_Result" required="yes" type="string"/>
            <outputParameter name="webapp_MoodleWebApp_Install_Result" required="yes" type="string"/>
            <outputParameter name="webapp_MoodleWebApp_Configure_Result" required="yes" type="string"/>
            <outputParameter name="db_createFolders_Result" required="yes" type="string"/>
            <outputParameter name="db_fixRights_Result" required="yes" type="string"/>
            <outputParameter name="db_MySQL_InstallDA_Result" required="yes" type="string"/>
            <outputParameter name="db_MySQL_Install_Result" required="yes" type="string"/>
            <outputParameter name="db_MySQL_Configure_Result" required="yes" type="string"/>
            <outputParameter name="db_MySQL_Start_Result" required="yes" type="string"/>
            <outputParameter name="db_MySQLDBHostedOnMySQL_ConfigureDB_Result" required="yes" type="string"/>
            <outputParameter name="MoodleDBConnection_connectToDatabase_Result" required="yes" type="string"/>
            <outputParameter name="MoodleWebApp_Start_Result" required="yes" type="string"/>
            <outputParameter name="CorrelationID" required="yes" type="correlation"/>
          </outputParameters>
        </plan>
      </plans>
    </serviceTemplate>
  </definitions>
</tosca:DocumentRoot>
